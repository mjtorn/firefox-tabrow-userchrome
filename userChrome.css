/* MULTI-ROW TABS
   based on https://www.reddit.com/r/FirefoxCSS/comments/7dclp7/multirow_tabs_in_ff57/
   If tabs are too narrow, go into about:config and adjust browser.tabs.tabMinWidth
   Updated from https://github.com/MrOtherGuy/firefox-csshacks.git f515efea7007450ac6354659d29061f63dd6b0cb
*/

/* Change the --multirow-n-rows to change maximum number of rows before the rows will start to scroll  */
/* Scrollbar can't be clicked but the rows can be scrolled with mouse */
/* This maximum visible rows won't work before Fx66 */
/* So this setting does nothing on Fx65 and all tab rows will be shown */
:root{ --multirow-n-rows: 3 }

/* General Rules */
#tabbrowser-tabs{
  min-height: unset !important;
  padding-inline-start: 0px !important
}

/* Test for Firefox > 66 */
@supports (inset-block:auto){
  #tabbrowser-tabs > .tabbrowser-arrowscrollbox > .arrowscrollbox-scrollbox{
    display: flex;
    flex-wrap: wrap;
    overflow-y: auto;
    max-height: calc(var(--tab-min-height) * var(--multirow-n-rows));
    scrollbar-color: var(--toolbar-bgcolor) var(--lwt-accent-color);
    scrollbar-width: thin;
  }
  #tabbrowser-tabs > .tabbrowser-arrowscrollbox {
    overflow: -moz-hidden-unscrollable;
    display: block;
  }
}

/* Test for Firefox < 66 */
@supports not (inset-block:auto){
  #tabbrowser-tabs > .tabbrowser-arrowscrollbox{
    min-height: unset !important;
  }
  #tabbrowser-tabs .scrollbox-innerbox{
    display: flex;
    flex-wrap: wrap;
    /* From the old version */
    min-height: var(--tab-min-height);
    max-height: calc((3 * var(--tab-min-height)) + 1px) !important; /* up to 3 rows */
    overflow-y: scroll;
    /* End old version */
  }
  #tabbrowser-tabs .arrowscrollbox-scrollbox {
    overflow: -moz-hidden-unscrollable;
    display: block;
  }
}

.tabbrowser-tab{ height: var(--tab-min-height); }
#tabbrowser-tabs .tabbrowser-tab[pinned]{
  position: static !important;
  margin-inline-start: 0px !important;
}

.tabbrowser-tab[fadein]:not([pinned]){
  min-width: 100px !important;
  flex-grow: 1;
  /*
  Uncomment to enable full-width tabs, also makes tab dragging a tiny bit more sensible
  Don't set to none or you'll see errors in console when closing tabs
  */
  /*max-width: 100vw !important;*/
}

.tabbrowser-tab > stack{ width: 100%; height: 100% }

#tabbrowser-tabs .scrollbutton-up,
#tabbrowser-tabs .scrollbutton-down,
#alltabs-button,
:root:not([customizing]) #TabsToolbar #new-tab-button,
#tabbrowser-tabs spacer,
.tabbrowser-tab::after{ display: none !important }

/* ////////////// */


/* Title bar rules */
#titlebar, #titlebar-buttonbox {
  height: var(--tab-min-height) !important;
}
#titlebar {
  margin-bottom: calc(var(--tab-min-height)*-1) !important;
}
#main-window[sizemode="maximized"] #titlebar {
  margin-bottom: calc(6px + var(--tab-min-height)*-1) !important;
}
#titlebar:active {
  margin-bottom: 0 !important;
}
#titlebar:active #titlebar-content {
  margin-bottom: var(--tab-min-height) !important;
}
/* Remove unnecessary buttons and the blank areas at left and right */
#tabbrowser-tabs .scrollbutton-up, #tabbrowser-tabs .scrollbutton-down,
#alltabs-button, .tabbrowser-tab:not([fadein]),
.titlebar-placeholder[type="pre-tabs"],
.titlebar-placeholder[type="post-tabs"] {
  display: none;
}
/* Ensure a border between tabs (#aaa is a light gray) */
.tabbrowser-tab:not(:last-of-type) {
  border-right: 1px solid #aaa !important;
}

/*
 * Taken from Reddit
 * https://www.reddit.com/r/FirefoxCSS/comments/7dclp7/multirow_tabs_in_ff57/
 */

/* New activity in tab */
.tabbrowser-tab[titlechanged] .tab-text.tab-label {
  color: #990000 !important;
  font-style: italic !important;
}

/* Selected (loaded) */
.tabbrowser-tab[selected="true"] .tab-label {
  color: #eee !important;
  font-style: normal !important;
  font-weight: bold !important;
  text-shadow: 1px 2px 1px #000 !important;
}

/* Loaded but unread (not selected) */
.tabbrowser-tab:not([selected="true"])[unread] .tab-label {
  color: #FF00FF !important;
  font-style: normal !important;
}

/* Not loaded yet (also visited) */
.tabbrowser-tab:not([selected="true"])[pending] .tab-label,
.tabbrowser-tab:not([selected="true"])[visited] .tab-label {
  color: #FF0000 !important;
  font-style: italic !important;
}

/* loading */
.tabbrowser-tab[busy] .tab-text.tab-label {
  color: #006bb3 !important;
  font-style: italic !important;
}

/* tab hover shows close button, but current tab always shows it */
.tabbrowser-tab:not([pinned]):hover .tab-close-button {
  display: -moz-box !important
}

